/**
 * jQuery Flow 2.7
 * 2012-09-04 
 *  
 * Jean-Baptiste Demonte 
 * jbdemonte@gmail.com
 * http://jb.demonte.fr/jquery/flow/
 *  
 * This work is licensed under the Creative Commons Attribution - Attribution-NonCommercial 
 * To view a copy of this license, visit http://creativecommons.org/licenses/by-nc/3.0/ 
 */
 ;(function(d,e){function b(){var n={},o=this,j=0,m=0,k=false,p={};function l(){if(!j&&!k){i("end",[{loaded:m,total:m+j}])}}function q(t,s){j--;m++;i("update",[{src:t,loaded:m,total:m+j}]);l()}function r(t){var s=new Image();n[t]=true;j++;s.onload=function(){q.call(o,t)};s.src=t}function i(t,s){if(t in p){d.each(p[t],function(u,v){v.apply(o,s)})}}this.startUpdate=function(){k=true};this.endUpdate=function(){k=false;l()};this.bind=function(t,s){if(!(t in p)){p[t]=[]}if(typeof(s)==="function"){p[t].push(s)}else{if(typeof(s)==="object"){d.each(s,function(u){o.bind.apply(o,[t,u])})}}};this.add=function(s){var t=d(s).attr("src");if(t in n){return false}r(t);return true}}function h(i,k){function j(){if(!i){return}while(k<0){k+=i}while(k>=i){k-=i}}this.inc=function(l){k+=l;j();return k};this.set=function(l){k=l;j()};this.val=function(){return k}}function c(i,j,l){var k,m={};if(j==="auto"&&l==="auto"){j=i>>1;l=i-j-1}else{if(j==="auto"){j=i-l-1}else{if(l==="auto"){l=i-j-1}}}k=Math.min(i,1+j+l);this.list=function(o){if(o in m){return m[o]}m[o]={};for(var n=0;n<k;n++){idx=n+o-j;if(idx<0){idx+=i}else{if(idx>=i){idx-=i}}m[o][idx]=n-j}return m[o]};this.before=function(){return j};this.after=function(){return l};this.visibles=function(){return k}}function g(j){var m=0,o=0,i=0,n,l=this;this.restart=function(){this.stop();m=0;n=d.now();o=setInterval(k,j.delai)};function k(){i=d.now()-n;m++;if(i>=j.duration){i=j.duration;j.tick.call(j.that);l.stop(true)}else{j.tick.call(j.that)}}this.stop=function(p){if(o){clearInterval(o);o=0;j.stop.call(j.that,p)}return this};this.value=function(){return{count:m,elapsed:i,duration:j.duration}}}function f(k,o){var l=this,q=[],r={previous:null,current:null},B=o.data||{},A,j=1,y,t,z,m=new b(),s,i,C=new g({delai:o.delai,duration:o.duration,that:this,tick:x,stop:u,debug:o.debug}),v;m.bind("update",function(D){p("load_update",D)});m.bind("end",function(D){p("load_end",D);w.apply(l,[])});p("load_begin");m.startUpdate();d("img",k).each(function(){m.add(this)});m.endUpdate();function p(F,D){var E=("on_"+F).replace(/\_(\w)/g,function(G,H){return H.toUpperCase()});if((E in o)&&(typeof(o[E])==="function")){o[E].call(k,D)}k.trigger(F+"."+o.namespace,[D])}function w(){d("> *",k).each(function(){var E=d(this),F=E.outerWidth(),D=E.outerHeight();q.push({element:E,size:{width:F,height:D,ratio:F/D},position:e,data:{}})});if(!q.length){return}s=new c(q.length,o.visible.before,o.visible.after);i=new c(q.length,"auto","auto");z=1/q.length;t=y=-z;A=new h(q.length,0);if(o.init){o.init.call(k,q,{data:B,before:s.before(),after:s.after(),count:q.length,visible:s.visibles(),options:o})}C.restart()}function n(){var K,F,H,E,D=C.value(),G=i.list(A.val());E=D.elapsed?o.easing(D.elapsed/D.duration,D.elapsed,0,1,D.duration):0;var J=z*A.val();var I=1-y+J;while(I>=1){I-=1}if(j<0){I=1-I}t=y+j*E*I;if(Math.abs(t)<0.0001){t=0}if(t<0){t+=1}while(t>=1){t-=1}K=t/z;F=Math.round(K);H=K-F;if(Math.abs(H)<0.0001){H=0}if(F>=q.length){F=0}return{item:F,offset:H}}function x(){var F,J,I=n(),G=s.list(I.item),E=i.list(I.item),D={target:A.val(),location:I,way:j,data:B,before:s.before(),after:s.after(),count:q.length,visible:s.visibles(),options:o},H=[];d.each(q,function(K,L){F=L.position;J=G[K];if(I.offset===0){L.position=J;if(J===0){r.previous=r.current;r.current={element:L.element}}}H.push({element:L.element,previous:F,current:J,position:E[K],size:L.size,data:L.data})});o.animate.call(k,H,D)}function u(D){y=t;p("run_end",{complete:D,current:r.current,previous:r.previous})}this.slide=function(I,G){var F,E=j,H=n(),D=C.stop().value();if((I==="next")||(I==="previous")){j=I==="next"?1:-1;if((E===j)||(D.elapsed===D.duration)){A.inc(j)}else{A.set(H.item+j)}}else{if(H.item==I){return}F=i.list(I);j=F[H.item]<F[I]?1:-1;A.set(I)}if(G!==e){v=G}C.restart()}}var a={};d.fn.flow=function(j){if(typeof(j)==="string"){j=j.toLowerCase();if(j==="plugin"){a[arguments[1]]=arguments[2];return}if((j!=="next")&&(j!=="previous")){j=parseInt(j)}}if((typeof(j)==="number")||(j==="next")||(j==="previous")){this.each(function(){var k=d.data(this,"flow");if(k){k.slide(j,arguments[1])}})}else{if(typeof(j)!=="object"){j={}}if(!((j.plugin&&j.plugin in a)||("animate" in j))){for(var i in a){j.plugin=i;break}}var l=d.extend(true,{namespace:"flow",visible:{before:"auto",after:"auto"},easing:"",duration:300,delai:13},j.plugin&&j.plugin in a?a[j.plugin]:{},j);if((typeof(l.easing)==="string")&&(l.easing in d.easing)){l.easing=d.easing[l.easing]}if(typeof(l.easing)!=="function"){l.easing=d.easing[d.easing.def||"swing"]}this.each(function(){d.data(this,"flow",new f(d(this),l))})}return this}})(jQuery);